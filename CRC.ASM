;include shmac.inc
include star14t.inc
code segment public byte
assume cs:code
public Calculate_CRC
public Calculate_CRC5
;-+----------------------------------------------------------+-
;ds:si=ptr
;di=size
;return:    cx:dx=crc32
;-+----------------------------------------------------------+-
Calculate_CRC5:
    mov     di, 5
Calculate_CRC:
    cld
    push    bx
    mov     cx, -1
    mov     dx, cx
    DO
        xor     ax, ax
        xor     bx, bx
        lodsb
        xor     al, cl
        mov     cl, ch
        mov     ch, dl
        mov     dl, dh
        mov     dh, 8
        DO
            shr     bx, 1
            rcr     ax, 1
            DOIF C
                xor     ax, 08320H
                xor     bx, 0EDB8H
            DONE
        dec     dh
        CYCLE NZ
        xor     cx, ax
        xor     dx, bx
    dec     di
    CYCLE NZ
    not     dx
    not     cx
    pop     bx
    mov     ax, dx
    ror     ax, cl
    add     ax, cx
    ret
;-+----------------------------------------------------------+-
ends
end
