;;MRORW MACRO w1, shval
;;PUSHSTATE
;;.386
;;        dw ((w1 and 0FFFFh) shr (shval and 0Fh)) or ((w1 and 0FFFFh) shl (10h-(shval and 0Fh)))
;;POPSTATE
;;ENDM


CRC32w MACRO moreshit
PUSHSTATE
.386
LOCAL cum_crc, byt, suxx
    cum_crc = 0FFFFFFFFh
    IRP _byt, <moreshit>
        byt = _byt xor (cum_crc and 0FFh)
        cum_crc = (cum_crc shr 8) and 0FFFFFFh
        REPT 8
            IF byt and 1
                byt = (byt shr 1) xor 0EDB88320H
            ELSE
                byt = byt shr 1
            ENDIF
        ENDM
        cum_crc = cum_crc xor byt
    ENDM
    cum_crc = not cum_crc

    suxx =  (((cum_crc shr 16) and 0FFFFh) shr (cum_crc and 0Fh)) or \
        (((cum_crc shr 16) and 0FFFFh) shl (10h-(cum_crc and 0Fh)))

    suxx = (suxx + cum_crc) and 0FFFFh ; add dx, cx
    dw suxx
POPSTATE
ENDM

cmp_ax_CRC32w MACRO moreshit
    db 3Dh
    CRC32w <moreshit>
ENDM
