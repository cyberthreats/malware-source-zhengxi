include zurich.asi
code segment byte public
assume cs:code, ds:code, es:code, ss:code
;extrn begin_rnd_procs:dword
;extrn carrier   :near
;extrn end_msg   :near
public r_lo
public r_hi
;.model tiny
;.code

;10DCD
;      r_hi r_lo
;-------------------
;      xxxx xxxx    r_lo * 0DCDh
; yyyy yyyy         r_hi * 0DCDh
; r_hi r_lo              * 1
;-------------------
;컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
pblabel RND_GET
    push    dx cx
    mov     ax, cs:r_lo
    mov     cx, 0DCDh
    mul     cx
    inc     ax
    adc     dx, 1111h
r_lo equ word ptr $-2
    mov     cs:r_lo, ax
    mov     ax, 1111h
r_hi equ word ptr $-2
    xchg    cx, dx
    mul     dx
    add     ax, cx
    mov     cs:r_hi, ax
    pop     cx dx
    sahf
    ret
;    dd      ?
;컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
pblabel RND_INIT
    push    ds si
    mov     si, 43h
    mov     ds, si
    push    word ptr ds:[si-43h*11h+46Ch] ;lo
    pop     cs:r_lo
    push    word ptr ds:[si-43h*11h+46Eh] ;hi
    pop     cs:r_hi

   push    ax
    in      al, 40h
    xor     byte ptr cs:r_hi, al
    pop     ax
    pop     si ds
    ret
;컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
;extrn Calculate_CRC :near
;컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
pblabel RND_GET_BYTE
    call    RND_GET
    mov     ah,0
    ret
;컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
pblabel RND_GET_THREE_BITS
    call    RND_GET_BYTE
    pushf
    and     al,00000111b
    popf
    ret
;컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
;rnd_procs_size = $-begin_rnd_procs
ends
end
